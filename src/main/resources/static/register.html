<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰§é‡ - æ³¨å†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft Yahei", sans-serif; }
        body {
            width: 100vw; height: 100vh;
            background: url("images/bg.jpg") no-repeat center center;
            background-size: cover;
            display: flex; align-items: center; justify-content: center;
        }
        .register-box {
            width: 800px;
            background: rgba(15, 25, 50, 0.85);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo h1 {
            color: #fff; font-size: 48px;
            display: flex; align-items: center; justify-content: center; gap: 15px;
        }
        .logo .star {
            width: 50px; height: 50px; background: #ff6600;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        .logo p { color: #fff; font-size: 20px; margin-top: 10px; opacity: 0.8; }
        .form-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .form-item { flex: 1; position: relative; }
        .form-item input {
            width: 100%; height: 50px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 0 20px 0 50px;
            color: #fff; font-size: 16px; outline: none;
            transition: all 0.3s;
        }
        .form-item input:focus { border-color: #ff6600; background: rgba(255,255,255,0.15); }
        .form-item .icon {
            position: absolute; left: 15px; top: 50%;
            transform: translateY(-50%); color: #fff;
            font-size: 20px; opacity: 0.7;
        }
        .form-item .get-code {
            position: absolute; right: 10px; top: 50%;
            transform: translateY(-50%);
            background: #ff6600; border: none; color: #fff;
            padding: 8px 15px; border-radius: 8px;
            cursor: pointer; font-size: 14px;
        }
        .form-item .get-code:disabled { background: #666; cursor: not-allowed; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; margin: 20px 0; color: #fff; }
        .checkbox-item input { width: 18px; height: 18px; }
        .checkbox-item a { color: #ff6600; text-decoration: none; }
        .register-btn {
            width: 100%; height: 55px;
            background: linear-gradient(90deg, #ff6600, #ff3300);
            border: none; border-radius: 10px;
            color: #fff; font-size: 20px; font-weight: bold;
            cursor: pointer; transition: all 0.3s;
        }
        .register-btn:hover { opacity: 0.9; }
        .login-link { text-align: center; margin-top: 20px; color: #fff; font-size: 16px; }
        .login-link a { color: #ff6600; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
<div class="register-box">
    <div class="logo">
        <h1><span class="star"></span>å‰§é‡</h1>
        <p>æ²‰æµ¸å¼å‰§æœ¬ç¤¾äº¤ï¼Œé‡è§åŒé¢‘æ­å­</p>
    </div>

    <div class="form-row">
        <div class="form-item">
            <span class="icon">ğŸ‘¤</span>
            <input type="text" id="username" placeholder="è¯·è®¾ç½®4-20ä½ç”¨æˆ·å">
        </div>
        <div class="form-item">
            <span class="icon">âœ‰ï¸</span>
            <input type="text" id="code" placeholder="6ä½éªŒè¯ç ">
            <button class="get-code" id="getCodeBtn">è·å–éªŒè¯ç </button>
        </div>
    </div>

    <div class="form-row">
        <div class="form-item">
            <span class="icon">ğŸ“±</span>
            <input type="text" id="phone" placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ç ">
        </div>
        <div class="form-item">
            <span class="icon">ğŸ”’</span>
            <input type="password" id="password" placeholder="è¯·è®¾ç½®6-20ä½å¯†ç ï¼Œå«å­—æ¯+æ•°å­—">
        </div>
    </div>

    <div class="form-row">
        <div class="form-item">
            <span class="icon">ğŸ”’</span>
            <input type="password" id="confirmPwd" placeholder="è¯·å†æ¬¡ç¡®è®¤å¯†ç ">
        </div>
    </div>

    <div class="checkbox-item">
        <input type="checkbox" id="agree">
        <label for="agree">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a href="#">ã€Šç”¨æˆ·åè®®ã€‹</a> å’Œ <a href="#">ã€Šéšç§æ”¿ç­–ã€‹</a></label>
    </div>

    <button class="register-btn" id="registerBtn">ç«‹å³æ³¨å†Œ</button>

    <div class="login-link">
        å·²æœ‰è´¦å·ï¼Ÿ <a href="login.html">å»ç™»å½•</a>
    </div>
</div>

<script>
    // 1. è·å–éªŒè¯ç é€»è¾‘
    document.getElementById('getCodeBtn').addEventListener('click', function() {
        const phone = document.getElementById('phone').value.trim();
        const getCodeBtn = document.getElementById('getCodeBtn');

        if (!phone || !phone.match(/^1[3-9]\d{9}$/)) {
            alert('è¯·å…ˆè¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·');
            return;
        }

        // è°ƒç”¨æ¥å£
        fetch('/captcha/getCode', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `phone=${encodeURIComponent(phone)}`
        })
            .then(res => {
                if (!res.ok) throw new Error('è·å–éªŒè¯ç å¤±è´¥');
                return res.json();
            })
            .then(data => {
                console.log('è·å–éªŒè¯ç å“åº”:', data);
                if (data.code === 200) {
                    // ================= æ ¸å¿ƒæ”¹åŠ¨ï¼šå¼¹çª—æ˜¾ç¤ºéªŒè¯ç  =================
                    const captchaCode = data.data;
                    alert(`ã€å‰§é‡ã€‘\næ‚¨çš„æ³¨å†ŒéªŒè¯ç æ˜¯ï¼š\n\nğŸ‘‰ ${captchaCode} ğŸ‘ˆ\n\nè¯·åœ¨5åˆ†é’Ÿå†…ä½¿ç”¨ã€‚`);

                    // å¼€å¯å€’è®¡æ—¶
                    let countDown = 60;
                    getCodeBtn.disabled = true;
                    const timer = setInterval(() => {
                        countDown--;
                        getCodeBtn.innerText = `${countDown}ç§’åé‡å‘`;
                        if (countDown <= 0) {
                            clearInterval(timer);
                            getCodeBtn.innerText = 'è·å–éªŒè¯ç ';
                            getCodeBtn.disabled = false;
                        }
                    }, 1000);
                } else {
                    alert(data.msg || 'è·å–éªŒè¯ç å¤±è´¥');
                }
            })
            .catch(err => {
                console.error('è·å–éªŒè¯ç å¤±è´¥:', err);
                alert('è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            });
    });

    // 2. æ³¨å†Œé€»è¾‘
    document.getElementById('registerBtn').addEventListener('click', function() {
        const username = document.getElementById('username').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const password = document.getElementById('password').value.trim();
        const confirmPwd = document.getElementById('confirmPwd').value.trim();
        const code = document.getElementById('code').value.trim();
        const agree = document.getElementById('agree').checked;

        if (!username) { alert('è¯·è¾“å…¥ç”¨æˆ·å'); return; }
        if (!phone) { alert('è¯·è¾“å…¥æ‰‹æœºå·'); return; }
        if (!code) { alert('è¯·è¾“å…¥éªŒè¯ç '); return; }
        if (!password) { alert('è¯·è¾“å…¥å¯†ç '); return; }
        if (password !== confirmPwd) { alert('ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´'); return; }
        if (!agree) { alert('è¯·åŒæ„åè®®'); return; }

        fetch('/api/user/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                username: username,
                password: password,
                confirmPassword: confirmPwd,
                phone: phone,
                code: code
            })
        })
            .then(res => {
                if (!res.ok) throw new Error('æ³¨å†Œå¤±è´¥');
                return res.json();
            })
            .then(data => {
                console.log('æ³¨å†Œå“åº”:', data);
                if (data.code === 200) {
                    alert('æ³¨å†ŒæˆåŠŸï¼');
                    window.location.href = 'login.html';
                } else {
                    alert(data.msg || 'æ³¨å†Œå¤±è´¥');
                }
            })
            .catch(err => {
                console.error('æ³¨å†Œå¤±è´¥:', err);
                alert('è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            });
    });
</script>
</body>
</html>